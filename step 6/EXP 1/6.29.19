library(Seurat)
dmso <- Read10X(data.dir = "C:/Users/JBH141/Documents/Seurat/EXP/dmso/")

# list options for groups to perform differential expression on
levels(dmso)

# Find differentially expressed features between CD14+ and CD8 Tcytes
monocyte.de.markers <- FindMarkers(dmso, ident.1 = "NK", ident.2 = "CD8 T")
# view results
head(monocyte.de.markers)

# Find differentially expressed features between NKcytes and all other cells, only
# search for positive markers
monocyte.de.markers <- FindMarkers(dmso, ident.1 = "NK", ident.2 = NULL, only.pos = TRUE)
# view results
head(monocyte.de.markers)

# Pre-filter features that are detected at <50% frequency in either NKcytes or FCGR3A+
# Monocytes
head(FindMarkers(dmso, ident.1 = "NK", ident.2 = "CD8 T", min.pct = 0.5))

# Pre-filter features that have less than a two-fold change between the average expression of
# NKcytes vs CD8 Tcytes
head(FindMarkers(dmso, ident.1 = "NK", ident.2 = "CD8 T", logfc.threshold = log(2)))

# Pre-filter features whose detection percentages across the two groups are similar (within
# 0.25)
head(FindMarkers(dmso, ident.1 = "NK", ident.2 = "CD8 T", min.diff.pct = 0.25))

# Increasing min.pct, logfc.threshold, and min.diff.pct, will increase the speed of DE testing,
# but could also miss features that are prefiltered

# Subsample each group to a maximum of 200 cells. Can be very useful for large clusters, or
# computationally-intensive DE tests
head(FindMarkers(dmso, ident.1 = "NK", ident.2 = "CD8 T", max.cells.per.ident = 200))




# Test for DE features using the MAST package
head(FindMarkers(dmso, ident.1 = "NK", ident.2 = "CD8 T", test.use = "MAST"))

# Test for DE features using the DESeq2 package. Throws an error if DESeq2 has not already been
# installed Note that the DESeq2 workflows can be computationally intensive for large datasets,
# but are incompatible with some feature pre-filtering options We therefore suggest initially
# limiting the number of cells used for testing
head(FindMarkers(dmso, ident.1 = "NK", ident.2 = "CD8 T", test.use = "DESeq2", max.cells.per.ident = 50))

